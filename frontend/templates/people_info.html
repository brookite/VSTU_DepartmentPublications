<ul class="nav nav-tabs mb-3" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="publications-tab"
                data-bs-toggle="tab"
                data-bs-target="#publications"
                type="button"
                role="tab"
                aria-controls="publications"
                aria-selected="true"
              >
                Публикации
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="information-tab"
                data-bs-toggle="tab"
                data-bs-target="#information"
                type="button"
                role="tab"
                aria-controls="information"
                aria-selected="false"
              >
                Информация
              </button>
            </li>
          </ul>
<div class="tab-content" id="main-tabs">
            <div
              class="tab-pane fade show active"
              id="publications"
              role="tabpanel"
              aria-labelledby="publications-tab"
            >
              <h3 data-current-author-id="{{ author.pk }}">{{ author.full_name }}</h3>
              <div id="tagsContainer" class="mt-2 mb-2">
                  {% for tag in tags %}
                      <span class="badge text-bg-primary" data-tag-id="{{ tag.pk }}">{{ tag.name }}</span>
                  {% endfor %}
              </div>
              <!-- Панель фильтрации и сортировки -->
              <div class="d-flex justify-content-between align-items-center mb-3 mt-3">
                  <div class="d-flex gap-2 align-items-center">
                      <!-- Выбор года -->
                      <select id="pubYearFilter" class="form-select w-auto">
                          <option value="all" {% if selected_year == "all" %}selected{% endif %}>Все годы</option>
                          {% for year in years_range %}
                              <option value="{{ year }}" {% if selected_year == year %}selected{% endif %}>{{ year }}</option>
                          {% endfor %}
                      </select>
                      
                      <!-- Кнопка сортировки -->
                      <button 
                          id="pubSortBtn" 
                          class="btn {% if sort_direction == 'asc' %}btn-primary active{% else %}btn-outline-secondary{% endif %}" 
                          type="button"
                          data-bs-toggle="button" 
                          autocomplete="off"
                          data-sort-dir="{{ sort_direction }}"
                          title="Сортировка по году"
                      >
                          {% if sort_direction == 'asc' %}
                              <i class="ri-sort-asc"></i> По возрастанию
                          {% else %}
                              <i class="ri-sort-desc"></i> По убыванию
                          {% endif %}
                      </button>
                  </div>
                  
                  <!-- Отображение кол-ва найденных -->
                  <small class="text-muted">Найдено: {{ publications.count }}</small>
              </div>
              <ul class="list-group">
                  {% for pub in publications %}
                <li
                  class="list-group-item d-flex justify-content-between align-items-start"
                >
                  <div class="ms-2 me-auto">
                    {% autoescape off %}
                    <div>{{ pub.html_content }}</div>
                    {% endautoescape %}
                    <div>
                      <small class="text-muted"
                        ><i class="ri-calendar-line"></i>{{ pub.added_date }}</small
                      >
                    </div>
                      {% if pub.department %}
                    <div>
                      <small class="text-muted"
                        ><i class="ri-graduation-cap-line"></i> {{ pub.department.name }}</small
                      >
                    </div>
                      {% endif %}
                  </div>
                </li>
                {% endfor %}
              </ul>
            </div>
            <div
              class="tab-pane fade"
              id="information"
              role="tabpanel"
              aria-labelledby="information-tab"
            >
              <section>
                <h2>Информация о пользователе</h2>
                <form>
                  <div class="mb-3">
                    <label for="fullName" class="form-label">ФИО</label>
                    <input
                      type="text"
                      class="form-control"
                      id="fullName"
                      placeholder="Введите ФИО"
                      value="{{ author.full_name }}"
                    />
                  </div>
                  <div class="mb-3">
                    <label for="lastNameInitials" class="form-label"
                      >Фамилия и инициалы</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="lastNameInitials"
                      placeholder="Введите фамилию и инициалы"
                      value="{{ author.library_primary_name }}"
                    />
                  </div>
                  <div class="mb-3">
                    <label for="department" class="form-label">Кафедра</label>
                    <select id="department" name="department" class="form-control">
                        {% for dep in departments %}
                            {% if dep.name == author.department.name %}
                            <option selected value="{{ dep.id }}">{{ dep.name }}</option>
                            {% else %}
                            <option value="{{ dep.id }}">{{ dep.name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                  </div>
                  <div class="mb-3">
                    <label for="tags" class="form-label">Теги</label>
                    <input
                      list="tagsList"
                      name="tags"
                      class="form-control tagsAddField"
                      data-for="editTagsContainer"
                      placeholder="Добавьте теги, разделяя их нажатием Enter"
                    />
                    <div class="tagsContainer mt-2" id="editTagsContainer">
                        {% for tag in tags %}
                      <span data-tag-id="{{ tag.pk }}" class="badge text-bg-primary"
                        >{{ tag.name }} <i class="removeTag ri-close-line"></i
                      ></span>
                        {% endfor %}
                    </div>
                  </div>
                  <div class="mb-3">
                    <label for="dateAdded" class="form-label"
                      >Дата добавления</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="dateAdded"
                      value="{{ author.added }}"
                      disabled
                    />
                  </div>
                    <div class="mb-3">
                    <label for="dateUpdated" class="form-label"
                      >Дата обновления</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="dateUpdated"
                      {% if author.last_updated %}
                      value="{{ author.last_updated }}"
                      {% else %}
                      value="Еще не обновлялся"
                      {% endif %}
                      disabled
                    />
                  </div>
                  <div class="mb-3">
                    <label for="nameAliases" class="form-label"
                      >Обозначения имени</label
                    >
                    <input
                      type="text"
                      class="form-control"
                      id="nameAliases"
                      placeholder="Добавьте обозначения, разделяя их запятыми"
                    />
                    <div id="aliasesContainer" class="mt-2">
                        {% for alias in aliases %}
                      <span class="badge text-bg-secondary"
                        > {{ alias.alias }}<i class="removeAlias ri-close-line"></i
                      ></span>
                        {% endfor %}
                    </div>
                    <small class="text-muted"
                      >Добавление обозначений не рекомендуется из-за возможной
                      нагрузки на систему</small
                    >
                  </div>
                {% if user.is_authenticated %}
                  <button type="submit" id="saveRecordBtn" class="btn btn-primary">
                    Сохранить изменения
                  </button>
                  <button type="button" id="removeRecordBtn" class="btn btn-danger">
                    Удалить запись
                  </button>
                {% endif %}
                </form>
              </section>
            </div>
          </div>
<script>
    $(document).ready(function() {
        const authorId = "{{ author.pk }}";
        const yearSelect = $("#pubYearFilter");
        const sortBtn = $("#pubSortBtn");

        // Функция перезагрузки списка с новыми параметрами
        function reloadPublications() {
            const year = yearSelect.val();
            // Если кнопка нажата (active) или имеет класс btn-primary -> asc, иначе desc
            // Но мы будем читать из data-атрибута для надежности, который переключим ниже
            const sort = sortBtn.attr("data-sort-dir");

            $.ajax({
                url: "/views/author_info",
                type: "GET",
                data: {
                    "author_id": authorId,
                    "year": year,
                    "sort": sort
                },
                dataType: "html",
                success: function (data) {
                    // Обновляем содержимое контейнера
                    $(".publView").html(data);
                    
                    // Важно: После перезагрузки нужно восстановить вкладку "Публикации" как активную,
                    // так как HTML рендерится заново и сбрасывает состояние табов Bootstrap.
                    // (Bootstrap 5 JS API)
                    const triggerEl = document.querySelector('#publications-tab');
                    const tab = new bootstrap.Tab(triggerEl);
                    tab.show();
                },
                error: function (xhr, status, error) {
                    console.error("Ошибка фильтрации: " + error);
                },
            });
        }

        // Обработка изменения года
        yearSelect.on("change", function() {
            reloadPublications();
        });

        // Обработка клика по кнопке сортировки
        sortBtn.on("click", function(e) {
            e.preventDefault(); // Предотвращаем стандартное поведение кнопки
            
            const currentDir = $(this).attr("data-sort-dir");
            const newDir = currentDir === "desc" ? "asc" : "desc";
            
            // Обновляем атрибут (визуальную часть обновит перезагрузка HTML)
            $(this).attr("data-sort-dir", newDir);
            
            reloadPublications();
        });
    });
</script>